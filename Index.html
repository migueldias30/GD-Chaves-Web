<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GD Chaves</title>
    <link rel="icon" type="image/png" href="GDChaves/Images/icon_chaves.png" />
    <link rel="stylesheet" href="GDChaves/CSS/styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <header></header>
    <div class="carousel-container">
        <button class="carousel-arrow left" onclick="moveSlide(-1)">
            <svg viewBox="0 0 24 48">
                <path d="M15 4L5 24L15 44" />
            </svg>
        </button>

        <div class="carousel-track" id="carouselTrack">
            <div class="carousel-slide video-slide">
                <video autoplay muted loop playsinline class="video-slide">
                    <source src="GDChaves/Videos/PresentationShirt.mp4" type="video/mp4">
                    O seu navegador não suporta o vídeo.
                </video>
            </div>

            <div class="carousel-slide kits-slide">
                <a href="GDChaves/Pages/roupa.html?id=1" data-id="1" class="kit-item">
                    <div class="kits-container">
                        <img src="GDChaves/Images/equipamento_principal.png" alt="Equipamento Principal">
                        <div class="kit-info">
                            <p class="kit-name">Equipamento Principal<br>24/25</p>
                            <div class="kit-price">
                                <div>
                                    <span class="kit-price-socio">Sócio</span>
                                    <span class="kit-price-socio">40,00€</span>
                                </div>
                                <div>
                                    <span class="kit-price-pvp">PVP</span>
                                    <span class="kit-price-pvp">60,00€</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>

                <a href="GDChaves/Pages/roupa.html?id=2" data-id="2" class="kit-item">
                    <div class="kits-container">
                        <img src="GDChaves/Images/equipamento_alternativo.png" alt="Equipamento Alternativo">
                        <div class="kit-info">
                            <p class="kit-name">Equipamento Alternativa<br>24/25</p>
                            <div class="kit-price">
                                <div>
                                    <span class="kit-price-socio">Sócio</span>
                                    <span class="kit-price-socio">40,00€</span>
                                </div>
                                <div>
                                    <span class="kit-price-pvp">PVP</span>
                                    <span class="kit-price-pvp">60,00€</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>

                <a href="GDChaves/Pages/roupa.html?id=3" data-id="3" class="kit-item">
                    <div class="kits-container">
                        <img src="GDChaves/Images/terceiro_equipamento.png?" alt="Terceiro Equipamento">
                        <div class="kit-info">
                            <p class="kit-name">Terceiro Equipamento<br>24/25</p>
                            <div class="kit-price">
                                <div>
                                    <span class="kit-price-socio">Sócio</span>
                                    <span class="kit-price-socio">40,00€</span>
                                </div>
                                <div>
                                    <span class="kit-price-pvp">PVP</span>
                                    <span class="kit-price-pvp">60,00€</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>

                <div class="shop-button-wrapper">
                    <a href="GDChaves/Pages/loja.html" class="shop-button">Loja</a>
                </div>
            </div>

        </div>

        <button class="carousel-arrow right" onclick="moveSlide(1)">
            <svg viewBox="0 0 24 48">
                <path d="M9 4L19 24L9 44" />
            </svg>
        </button>
    </div>
    <div class="text-section">
        <h1>Acompanha os jogos do GD Chaves</h1>
        <p>Fica a par dos nossos jogos</p>

        <div class="card-container" id="ultimos-jogos-container">
            <p class="sem-jogos">A carregar jogos...</p>
        </div>
    </div>

    <div class="sponsors-section">
        <div class="main-sponsor">
            <a href="https://www.espacial.pt/" target="_blank">
                <img src="GDChaves/Images/espacial_musica.png" data-color="GDChaves/Images/espacial_musica.png"
                    alt="Espacial Musica">
            </a>
            <a href="https://www.chaves.pt/" target="_blank">
                <img src="GDChaves/Images/municipio_de_chaves.png" data-color="GDChaves/Images/municipio_de_chaves.png"
                    alt="Municipio de Chaves">
            </a>
        </div>

        <div class="sponsors-grid">
            <a href="https://cm-vpaguiar.pt/" target="_blank">
                <img src="GDChaves/Images/municipio_de_vilapouca.png"
                    data-color="GDChaves/Images/municipio_de_vilapouca.png" alt="Municipio de Vila Pouca">
            </a>
            <a href="https://marilina.pt/" target="_blank">
                <img src="GDChaves/Images/mariliana.png" data-color="GDChaves/Images/mariliana.png" alt="Mariliana">
            </a>
            <a href="https://meltino.com/" target="_blank">
                <img src="GDChaves/Images/meltino.png" data-color="GDChaves/Images/meltino.png" alt="Meltino">
            </a>
            <a href="https://www.premiumchaves.com/" target="_blank">
                <img src="GDChaves/Images/premium_chaves.png" data-color="GDChaves/Images/premium_chaves.png"
                    alt="Premium Chaves">
            </a>
            <a href="https://naturwaterpark.pt/inicio" target="_blank">
                <img src="GDChaves/Images/nature_waterpark.png" data-color="GDChaves/Images/nature_waterpark.png"
                    alt="Nature Waterpark">
            </a>
            <a href="https://www.cervejaquinas.com/" target="_blank">
                <img src="GDChaves/Images/quinas.png" data-color="GDChaves/Images/quinas.png" alt="Quinas">
            </a>
            <a href="https://www.qviagem.com/" target="_blank">
                <img src="GDChaves/Images/qviagem.png" data-color="GDChaves/Images/qviagem.png" alt="Q Viagem">
            </a>
            <a href="https://www.pixellight.pt/" target="_blank">
                <img src="GDChaves/Images/pixel_light.png" data-color="GDChaves/Images/pixel_light.png"
                    alt="Pixel Light">
            </a>
            <a href="https://reconco.pt/" target="_blank">
                <img src="GDChaves/Images/reconco.png" data-color="GDChaves/Images/reconco.png" alt="Reconco">
            </a>
            <a href="https://www.facebook.com/TrazmusicaEspectaculos/" target="_blank">
                <img src="GDChaves/Images/tras_musica.png" data-color="GDChaves/Images/tras_musica.png"
                    alt="Traz Música">
            </a>
            <a href="https://www.mcoutinho.pt/" target="_blank">
                <img src="GDChaves/Images/mcoutinho.png" data-color="GDChaves/Images/mcoutinho.png" alt="MCoutinho">
            </a>
            <a href="https://www.underblue.net/" target="_blank">
                <img src="GDChaves/Images/under_blue.png" data-color="GDChaves/Images/under_blue.png" alt="Under Blue">
            </a>
            <a href="https://www.fortesaofrancisco.com/pt/index.html" target="_blank">
                <img src="GDChaves/Images/forte_sfrancisco.png" data-color="GDChaves/Images/forte_sfrancisco.png"
                    alt="Forte de S. Francisco">
            </a>
            <a href="https://www.fercarvalho.pt/" target="_blank">
                <img src="GDChaves/Images/fercarvalho.png" data-color="GDChaves/Images/fercarvalho.png"
                    alt="FerCarvalho">
            </a>
            <a href="https://ecocozinhas.pt/www/" target="_blank">
                <img src="GDChaves/Images/ecocozinhas.png" data-color="GDChaves/Images/ecocozinhas.png"
                    alt="EcoCozinhas">
            </a>
            <a href="https://www.anteros.pt/" target="_blank">
                <img src="GDChaves/Images/anteros.png" data-color="GDChaves/Images/anteros.png" alt="Anteros">
            </a>
            <a href="https://lacatoni.com/" target="_blank">
                <img src="GDChaves/Images/lacatoni.png" data-color="GDChaves/Images/lacatoni.png" alt="Lacatoni">
            </a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const btnRegister = document.getElementById("btnRegister");
            btnRegister.addEventListener("click", async (e) => {
                e.preventDefault();

                const isMember = document.getElementById("isMember").checked;
                const nome = document.getElementById("name").value;
                const email = document.getElementById("email").value;
                const birthdate = document.getElementById("birthdate").value;
                const memberNumber = isMember ? document.getElementById("memberNumber").value : "";
                const password = document.getElementById("password").value;
                const confirmPassword = document.getElementById("confirmPassword").value;

                if (password !== confirmPassword) {
                    alert("As passwords não coincidem.");
                    return;
                }

                try {
                    console.log({
                        isMember,
                        nome,
                        email,
                        birthdate,
                        memberNumber,
                        password
                    });
                    const response = await fetch('http://localhost:8080/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            isMember,
                            nome,
                            email,
                            birthdate,
                            memberNumber,
                            password
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Erro ao registar a conta.');
                    }

                    localStorage.setItem('userId', (await response.json()).userId);
                    alert('Conta criada com sucesso!');
                } catch (error) {
                    console.error(error);
                    alert('Ocorreu um erro ao criar a conta. Por favor, tente novamente.');
                }
            });
        });
    </script>

    <div id="registerModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-button" id="closeRegisterModal">&times;</span>
            <h2>Registo de Conta</h2>

            <div class="checkbox-socio">
                <input type="checkbox" id="isMember" name="isMember">
                <label for="isMember">Sou sócio</label>
            </div>

            <div class="input-group">
                <input type="text" id="name" name="name" placeholder="Nome" required />
            </div>

            <div class="input-group">
                <input type="email" id="email" name="email" placeholder="Email" required />
            </div>

            <div class="input-group">
                <input type="date" id="birthdate" name="birthdate" placeholder="Data de nascimento" required />
            </div>

            <div class="input-group hidden" id="memberNumberContainer">
                <input type="text" id="memberNumber" name="memberNumber" placeholder="Número de Sócio" />
            </div>

            <div class="input-group">
                <input type="password" id="password" name="password" placeholder="Password" required />
            </div>

            <div class="input-group">
                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirmar Password"
                    required />
            </div>

            <button id="btnRegister" type="submit">Criar Conta</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const loginBtn = document.getElementById("loginBtn");
            if (loginBtn) {
                loginBtn.addEventListener("click", async (e) => {
                    e.preventDefault();

                    const email = document.getElementById("emailLogin").value;
                    const password = document.getElementById("passwordLogin").value;

                    try {
                        const response = await fetch("http://localhost:8080/api/auth/login", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ email, password })
                        });

                        if (!response.ok) {
                            throw new Error("Credenciais inválidas.");
                        }

                        const result = await response.json();
                        localStorage.setItem("userId", result.userId);
                        window.location.href = "GDChaves/Pages/conta.html";
                    } catch (error) {
                        console.error("Erro no login:", error);
                        alert("Login falhou: " + error.message);
                    }
                });
            }
        });
    </script>


    <div id="loginModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-button" id="closeLoginModal">&times;</span>
            <h2>Iniciar Sessão</h2>

            <div class="input-group">
                <input type="email" id="emailLogin" name="email" placeholder="Email" required />
            </div>

            <div class="input-group">
                <input type="password" id="passwordLogin" name="password" placeholder="Password" required />
            </div>

            <button id="loginBtn">Entrar</button>
        </div>
    </div>

    <footer class="footer"></footer>

    <script src="main.js"></script>

    <script>
        let currentSlide = 0;
        const track = document.getElementById("carouselTrack");
        const slides = track.children;
        const totalSlides = slides.length;

        function moveSlide(direction) {
            currentSlide += direction;

            if (currentSlide < 0) {
                currentSlide = totalSlides - 1;
            } else if (currentSlide >= totalSlides) {
                currentSlide = 0;
            }

            const offset = -currentSlide * window.innerWidth;
            track.style.transform = `translateX(${offset}px)`;
        }

        document.querySelectorAll('.sponsors-grid img').forEach(img => {
            const original = img.src;
            const color = img.getAttribute('data-color');

            img.addEventListener('mouseenter', () => {
                img.src = color;
            });

            img.addEventListener('mouseleave', () => {
                img.src = original;
            });
        });

        async function loadHTML(selector, url) {
            const response = await fetch(url);
            if (response.ok) {
                const text = await response.text();
                document.querySelector(selector).innerHTML = text;

                if (selector === 'header') {
                    const logo = document.getElementById("logo-link");
                    if (logo) {
                        logo.addEventListener("click", function (e) {
                            e.preventDefault();
                            window.scrollTo({
                                top: 0,
                                behavior: "smooth"
                            });
                        });
                    }

                    const registerModal = document.getElementById("registerModal");
                    const openLink = document.getElementById("openRegisterModal");
                    const closeBtn = document.getElementById("closeRegisterModal");

                    if (openLink && registerModal && closeBtn) {
                        openLink.addEventListener("click", (e) => {
                            e.preventDefault();
                            registerModal.style.display = "block";
                        });

                        closeBtn.addEventListener("click", () => {
                            registerModal.style.display = "none";
                        });

                        window.addEventListener("click", (event) => {
                            if (event.target === registerModal) {
                                registerModal.style.display = "none";
                            }
                        });
                    }
                    const isMemberCheckbox = document.getElementById("isMember");
                    const memberNumberContainer = document.getElementById("memberNumberContainer");

                    memberNumberContainer.style.display = "none";
                    isMemberCheckbox.checked = false;

                    isMemberCheckbox.addEventListener("change", () => {
                        memberNumberContainer.style.display = isMemberCheckbox.checked ? "block" : "none";
                    });

                    const loginModal = document.getElementById("loginModal");
                    const openLoginlink = document.getElementById("openLoginModal");
                    const closeLoginBtn = document.getElementById("closeLoginModal");

                    if (openLoginlink && loginModal && closeLoginBtn) {
                        openLoginlink.addEventListener("click", (e) => {
                            e.preventDefault();
                            loginModal.style.display = "block";
                        });

                        closeLoginBtn.addEventListener("click", () => {
                            loginModal.style.display = "none";
                        });

                        window.addEventListener("click", (event) => {
                            if (event.target === loginModal) {
                                loginModal.style.display = "none";
                            }
                        });
                    }
                    const hamburgerBtn = document.getElementById("hamburgerBtn");
                    const mobileMenu = document.getElementById("mobileMenu");
                    const userBtn = document.getElementById("userBtn");
                    const userMenuMobile = document.getElementById("userMenuMobile");

                    if (hamburgerBtn && mobileMenu) {
                        hamburgerBtn.addEventListener("click", () => {
                            mobileMenu.classList.toggle("active");
                        });
                    }

                    if (userBtn && userMenuMobile) {
                        userBtn.addEventListener("click", () => {
                            userMenuMobile.classList.toggle("active");
                        });
                    }
                }
                document.getElementById("logoutBtn")?.addEventListener("click", function (e) {
                    e.preventDefault();
                    localStorage.removeItem("userId");
                    alert("Sessão terminada com sucesso.");
                    window.location.href = "../../index.html";
                });
            }
            const loginLink = document.getElementById("openLoginModal");
            const registerLink = document.getElementById("openRegisterModal");
            const userDropdown = document.getElementById("userDropdown");

            const userId = localStorage.getItem("userId");

            if (userId) {
                if (loginLink) loginLink.style.display = "none";
                if (registerLink) registerLink.style.display = "none";
                if (userDropdown) userDropdown.style.display = "block";
            } else {
                if (loginLink) loginLink.style.display = "inline-block";
                if (registerLink) registerLink.style.display = "inline-block";
                if (userDropdown) userDropdown.style.display = "none";
            }
        }

        async function carregarUltimosJogos() {
            const response = await fetch("http://localhost:8080/games");
            const jogos = await response.json();

            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            const jogosPassados = jogos
                .filter(j => new Date(j.date) < hoje)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 3);

            const container = document.getElementById("ultimos-jogos-container");

            if (!jogosPassados.length) {
                container.innerHTML = '<p class="sem-jogos">Sem jogos realizados</p>';
                return;
            }

            container.innerHTML = jogosPassados.map(jogo => {
                const data = new Date(jogo.date);
                const diaSemana = data.toLocaleDateString('pt-PT', { weekday: 'short' }).slice(0, 3).toUpperCase();
                const diaMes = data.toLocaleDateString('pt-PT', { day: '2-digit', month: '2-digit' });
                const hora = jogo.gameHr;

                const chavesEmCasa = jogo.name.toLowerCase().startsWith("gd chaves") || jogo.name.toLowerCase().startsWith("chaves");
                const equipaCasa = chavesEmCasa ? "GD Chaves" : jogo.opponent.name;
                const equipaFora = chavesEmCasa ? jogo.opponent.name : "GD Chaves";

                const logoCasa = equipaCasa === "GD Chaves"
                    ? "GDChaves/Images/logo_chaves.png"
                    : `GDChaves/Images/logo_${limparNome(equipaCasa)}.png`;

                const logoFora = equipaFora === "GD Chaves"
                    ? "GDChaves/Images/logo_chaves.png"
                    : `GDChaves/Images/logo_${limparNome(equipaFora)}.png`;

                const resultado = jogo.gameRes ?? " : ";

                return `
                    <div class="match-card horizontal-layout">
                        <div class="match-info">
                            <p><strong>${diaSemana} ${diaMes}, ${hora}</strong></p>
                            <p>${jogo.competition?.name ?? "Competição"} | <span class="canal">SPORT TV +</span></p>
                        </div>
                        <div class="match-content-horizontal">
                            <div class="team-horizontal">
                                <img src="${logoCasa}" alt="${equipaCasa}" onerror="this.src='GDChaves/Images/logo_default.png'">
                                <p>${equipaCasa}</p>
                            </div>
                            <div class="score-horizontal">
                                    <span class="score">${resultado.split(" : ")[0]}</span>
                            </div>
                            <div class="team-horizontal">
                                <img src="${logoFora}" alt="${equipaFora}" onerror="this.src='GDChaves/Images/logo_default.png'">
                                <p>${equipaFora}</p>
                            </div>
                        </div>
                        <div class="match-action">
                            <a href="${jogo.summaryUrl || "#"}" target="_blank">Resumo <span>›</span></a>
                        </div>
                    </div>
                `;
            }).join("");

        }

        function limparNome(nome) {
            return nome
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "")
                .replace(/\s+/g, '');
        }

        window.addEventListener("DOMContentLoaded", async () => {
            await carregarUltimosJogos();
        });
    </script>



</body>

</html>