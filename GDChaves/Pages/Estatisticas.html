<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GD Chaves - Estatísticas</title>
    <link rel="icon" type="image/png" href="GDChaves/Images/icon_chaves.png" />
    <link rel="stylesheet" href="../CSS/styles.css" />
    <link rel="stylesheet" href="../CSS/styles9.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <header></header>

    <div class="sub-header">
        <h1>Estatísticas</h1>
    </div>

    <div class="idade-barra-container">
        <span id="idade-min" class="idade-label"></span>
        <div class="barra-dinamica">
            <div id="media-texto-1" class="media-texto">Média de Idades</div>
            <div class="barra-wrapper">
                <div id="barra-esquerda" class="barra-esquerda"></div>
            </div>
        </div>
        <span id="idade-max" class="idade-label"></span>
    </div>

    <div class="barra-container">
        <span id="idade-min-2" class="idade-label"></span>
        <div class="barra-dinamica">
            <div id="media-texto-2" class="media-texto">Média de Idades Jogadores</div>
            <div class="barra-wrapper">
                <div id="barra-esquerda-2" class="barra-esquerda"></div>
            </div>
        </div>
        <span id="idade-max-2" class="idade-label"></span>
    </div>

    <div class="barra-container">
        <span id="altura-min" class="idade-label"></span>
        <div class="barra-dinamica">
            <div id="altura-media-texto" class="media-texto">Média de Alturas</div>
            <div class="barra-wrapper">
                <div id="barra-altura" class="barra-esquerda"></div>
            </div>
        </div>
        <span id="altura-max" class="idade-label"></span>
    </div>

    <div class="barra-container">
        <span id="peso-min" class="idade-label"></span>
        <div class="barra-dinamica">
            <div id="peso-media-texto" class="media-texto">Média de Peso</div>
            <div class="barra-wrapper">
                <div id="barra-peso" class="barra-esquerda"></div>
            </div>
        </div>
        <span id="peso-max" class="idade-label"></span>
    </div>

    <div class="barra-container">
        <span class="idade-label">0</span>
        <div class="barra-dinamica">
            <div id="golos-media-texto" class="media-texto">Média de Golos</div>
            <div class="barra-wrapper">
                <div id="barra-golos" class="barra-esquerda"></div>
            </div>
        </div>
        <span class="idade-label">5</span>
    </div>

    <h2 style="text-align:center; margin-top: 20px; margin-bottom: 20px;">Vendas por Categoria de Acessórios</h2>
    <div class="tabela-wrapper">
        <table class="tabela-vendas">
            <thead>
                <tr>
                    <th>Categoria</th>
                    <th>Frequência Absoluta</th>
                    <th>Frequência Relativa</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Camisolas</td>
                    <td>120</td>
                    <td>30%</td>
                </tr>
                <tr>
                    <td>Cachecois</td>
                    <td>80</td>
                    <td>20%</td>
                </tr>
                <tr>
                    <td>Bonés</td>
                    <td>60</td>
                    <td>15%</td>
                </tr>
                <tr>
                    <td>Mantas</td>
                    <td>40</td>
                    <td>10%</td>
                </tr>
                <tr>
                    <td>Mochilas</td>
                    <td>50</td>
                    <td>12.5%</td>
                </tr>
                <tr>
                    <td>Canecas</td>
                    <td>50</td>
                    <td>12.5%</td>
                </tr>
                <tr class="total-row">
                    <td><strong>Total</strong></td>
                    <td><strong>400</strong></td>
                    <td><strong>100%</strong></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="graficos-container">
        <div class="grafico-box">
            <h2>Histograma das Idades (Jogadores)</h2>
            <canvas id="grafico-idades2"></canvas>
        </div>

        <div class="grafico-box">
            <h2>Distribuição das Idades (Sócios)</h2>
            <canvas id="grafico-idades1"></canvas>
        </div>
    </div>

    <div class="graficos-container">
        <div class="grafico-box">
            <h2>Preços dos Produtos</h2>
            <canvas id="grafico-precos"></canvas>
        </div>
        <div class="grafico-box-vendas">
            <div class="grafico-box">
                <h2>Gráfico das Vendas de Acessórios</h2>
                <canvas id="grafico-vendas"></canvas>
            </div>
        </div>
    </div>

    <footer class="footer"></footer>

    <script src="main.js"></script>

    <script>
        document.getElementById("logo-link")?.addEventListener("click", function (e) {
            e.preventDefault();
            window.location.href = "../../Index.html";
        });

        const idadesSocios = [17, 22, 30, 25, 35, 40, 45, 50, 19, 28, 17, 22, 30, 25, 35,
            40, 45, 50, 19, 28, 17, 22, 30, 25, 35, 40, 45, 50, 19, 28, 17, 22, 30, 25,
            35, 40, 45, 50, 17, 18];
        const min = Math.min(...idadesSocios);
        const max = Math.max(...idadesSocios);
        const media = (idadesSocios.reduce((a, b) => a + b, 0) / idadesSocios.length).toFixed(1);
        const percent = ((media - min) / (max - min)) * 100;

        document.getElementById("idade-min").innerText = `${min} anos`;
        document.getElementById("idade-max").innerText = `${max} anos`;
        document.getElementById("barra-esquerda").style.width = `${percent}%`;
        document.getElementById("media-texto-1").innerText = `Média de Idades (Sócios): ${media}`;

        async function carregarDadosJogadores() {
            try {
                const response = await fetch("http://localhost:8080/players/withPosition");
                const jogadores = await response.json();
                console.log(jogadores)
                const hoje = new Date();
                const idades = jogadores.map(j => {
                    const nascimento = new Date(j.birthdate);
                    let idade = hoje.getFullYear() - nascimento.getFullYear();
                    const m = hoje.getMonth() - nascimento.getMonth();
                    if (m < 0 || (m === 0 && hoje.getDate() < nascimento.getDate())) idade--;
                    return idade;
                });

                const alturas = jogadores.map(j => j.height).filter(h => h);
                const pesos = jogadores.map(j => j.weight).filter(p => p);

                const minIdade = Math.min(...idades);
                const maxIdade = Math.max(...idades);
                const mediaIdade = (idades.reduce((a, b) => a + b, 0) / idades.length).toFixed(1);
                const percentIdade = ((mediaIdade - minIdade) / (maxIdade - minIdade)) * 100;

                document.getElementById("idade-min-2").innerText = `${minIdade} anos`;
                document.getElementById("idade-max-2").innerText = `${maxIdade} anos`;
                document.getElementById("media-texto-2").innerText = `Média de Idades (Jogadores): ${mediaIdade}`;
                document.getElementById("barra-esquerda-2").style.width = `${percentIdade}%`;

                const minAltura = Math.min(...alturas);
                const maxAltura = Math.max(...alturas);
                const mediaAltura = (alturas.reduce((a, b) => a + b, 0) / alturas.length).toFixed(1);
                const percentAltura = ((mediaAltura - minAltura) / (maxAltura - minAltura)) * 100;

                document.getElementById("altura-min").innerText = `${minAltura} cm`;
                document.getElementById("altura-max").innerText = `${maxAltura} cm`;
                document.getElementById("altura-media-texto").innerText = `Média de Alturas (Jogadores): ${mediaAltura} cm`;
                document.getElementById("barra-altura").style.width = `${percentAltura}%`;

                const minPeso = Math.min(...pesos);
                const maxPeso = Math.max(...pesos);
                const mediaPeso = (pesos.reduce((a, b) => a + b, 0) / pesos.length).toFixed(1);
                const percentPeso = ((mediaPeso - minPeso) / (maxPeso - minPeso)) * 100;

                document.getElementById("peso-min").innerText = `${minPeso} kg`;
                document.getElementById("peso-max").innerText = `${maxPeso} kg`;
                document.getElementById("peso-media-texto").innerText = `Média de Peso (Jogadores): ${mediaPeso} kg`;
                document.getElementById("barra-peso").style.width = `${percentPeso}%`;

                // Histograma das idades dos jogadores
                const bins = {
                    '18-21': 0, '22-25': 0, '26-29': 0,
                    '30-33': 0, '34-37': 0, '38-41': 0
                };
                idades.forEach(idade => {
                    if (idade <= 21) bins['18-21']++;
                    else if (idade <= 25) bins['22-25']++;
                    else if (idade <= 29) bins['26-29']++;
                    else if (idade <= 33) bins['30-33']++;
                    else if (idade <= 37) bins['34-37']++;
                    else bins['38-41']++;
                });

                new Chart(document.getElementById("grafico-idades2"), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(bins),
                        datasets: [{
                            label: 'Nº de Jogadores',
                            data: Object.values(bins),
                            backgroundColor: '#541833'
                        }]
                    },
                    options: {
                        scales: {
                            x: { title: { display: true, text: 'Idade (anos)' } },
                            y: { beginAtZero: true, title: { display: true, text: 'Frequência' } }
                        }
                    }
                });

            } catch (erro) {
                console.error("Erro ao carregar dados dos jogadores:", erro);
            }
        }

        window.addEventListener("DOMContentLoaded", () => {
            carregarDadosJogadores();

            const golos = 40;
            const jogos = 34;
            const mediaGolos = (golos / jogos).toFixed(2);
            const maxGolosEsperado = 5;
            const percentGolos = (mediaGolos / maxGolosEsperado) * 100;

            document.getElementById("golos-media-texto").innerText = `Média de Golos por Jogo: ${mediaGolos}`;
            document.getElementById("barra-golos").style.width = `${percentGolos}%`;

            // Histograma das idades dos sócios
            const idadeFrequencias1 = {};
            idadesSocios.forEach(idade => {
                idadeFrequencias1[idade] = (idadeFrequencias1[idade] || 0) + 1;
            });

            const labels1 = Object.keys(idadeFrequencias1).sort((a, b) => a - b);
            const dados1 = labels1.map(idade => idadeFrequencias1[idade]);

            new Chart(document.getElementById("grafico-idades1"), {
                type: 'bar',
                data: {
                    labels: labels1,
                    datasets: [{
                        label: 'Nº de pessoas',
                        data: dados1,
                        backgroundColor: '#541833'
                    }]
                },
                options: {
                    scales: {
                        x: { title: { display: true, text: 'Idade (anos)' } },
                        y: { beginAtZero: true, title: { display: true, text: 'Frequência' } }
                    }
                }
            });

            const categorias = ["Camisolas", "Cachecois", "Bonés", "Mantas", "Mochilas", "Canecas"];
            const vendas = [120, 80, 60, 40, 50, 50];

            new Chart(document.getElementById("grafico-vendas"), {
                type: 'pie',
                data: {
                    labels: categorias,
                    datasets: [{
                        data: vendas,
                        backgroundColor: ['#541833', '#7a2a52', '#a13c6c', '#c94e86', '#f05fa0', '#ff77b8']
                    }]
                }
            });

            new Chart(document.getElementById('grafico-precos'), {
                type: 'bar',
                data: {
                    labels: [
                        'Camisola Principal', 'Camisola Alternativa', 'Camisola 3º Equipamento',
                        'Mochila', 'Canecas', 'Toalhas', 'Cachecois', 'Mantas', 'Bola', 'Gorros'
                    ],
                    datasets: [{
                        label: 'Preço (€)',
                        data: [60, 60, 60, 20, 7.5, 20, 5, 20, 20, 7.5],
                        backgroundColor: '#541833'
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Preço (€)' } },
                        x: { title: { display: true, text: 'Produto' } }
                    }
                }
            });
        });
    </script>

</body>

</html>